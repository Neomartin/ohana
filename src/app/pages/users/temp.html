<div class="row noDisplay">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <table mat-table [dataSource]="dataSource" fxFlex *ngIf="dataSource">
          <ng-container  matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef fxLayoutAlign="start center" fxFlex>
              Nombre y Apellido
            </th>
            <td mat-cell *matCellDef="let client; let i = index"  fxLayoutAlign="start center" fxFlex> 
              <div *ngIf="client._id !== editable" >
                {{ client.name + ' ' + client.surname }}
              </div>
              <div *ngIf="client._id === editable">
                <mat-form-field fxFlex style="margin-right: 7px;">
                  <input type="text" matInput placeholder="nombre" [(ngModel)]="client.name" name="name" />
                </mat-form-field>
                <mat-form-field fxFlex class="m-r-20">
                  <input type="text" matInput placeholder="apellido" [(ngModel)]="client.surname" name="surname"/>
                </mat-form-field>
              </div>
            </td>            
          </ng-container>
          <ng-container matColumnDef="phone" >
            <th mat-header-cell *matHeaderCellDef fxLayoutAlign="start center" fxFlex="160px">
              Teléfono
            </th>
            <td mat-cell *matCellDef="let client; let i = index" fxLayoutAlign="start center" fxFlex="160px">
              <span *ngFor="let phone of client.phone; let k = index; trackBy:trackByFn">
                <div *ngIf="client._id !== editable" >
                  <ng-container *ngIf="phone === '260-4' || !phone; else elsePhone">
                    Sin Teléfono
                  </ng-container>
                  <ng-template #elsePhone>
                    {{ phone }}
                  </ng-template>
                </div>
                <div *ngIf="client._id === editable">
                  <mat-form-field class="p-r-10">
                    <input type="text" matInput
                          [(ngModel)]="dataSource[i].phone[k]" name="phone"/>
                  </mat-form-field>
                </div>
              </span>
            </td>
          </ng-container>
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef fxLayoutAlign="start center" fxFlex="220px">
              Email
            </th>
            <td mat-cell *matCellDef="let client; let i = index" fxLayoutAlign="start center" fxFlex="220px">
              <div *ngIf="client._id !== editable" >
                <ng-container *ngIf="client.email; else elseEmail">
                  {{ client.email }}
                </ng-container>
                <ng-template #elseEmail>
                  Sin Email
                </ng-template>
              </div>
              <div *ngIf="client._id === editable">
                <mat-form-field class="m-r-20">
                  <input type="text" matInput 
                        [(ngModel)]="dataSource[i].email" name="email"/>
                </mat-form-field>
              </div>
            </td>
          </ng-container>
          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef fxLayoutAlign="start center" fxFlex="120px">
              Tipo
            </th>
            <td mat-cell *matCellDef="let client; let i = index" fxLayoutAlign="start center" fxFlex="120px">
              <div *ngIf="client._id !== editable">
                <span class="badge badge-info px-2 py-1" *ngIf="client.role === 'CLIENT_ROLE'">Cliente</span>
                <span class="badge b-green px-2 py-1" *ngIf="client.role === 'USER_ROLE'">Usuario</span>
                <span class="badge b-red px-2 py-1" *ngIf="client.role === 'ADMIN_ROLE'">Administrador</span>
              </div>
              <div *ngIf="client._id === editable" fxFlex>
                <mat-form-field fxFlex >
                  <!-- <mat-label>Favorite food</mat-label> -->
                  <mat-select [(value)]="client.role">
                    <mat-option *ngFor="let role of roles" [value]="role.value">
                      {{role.viewValue}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              
            </td>
          </ng-container>
          <!-- <ng-container matColumnDef="office" *ngIf="currentUser.role === 'ADMIN_ROLE'" fxFlex="160px">
            San Rafael - Olascoaga 21
          </ng-container> -->
          
          <ng-container matColumnDef="options">
            <th mat-header-cell *matHeaderCellDef fxLayoutAlign="start center" fxFlex="100px">
              Edit
            </th>
            <td mat-cell *matCellDef="let client, let i = index" fxLayoutAlign="start center" fxFlex="100px">
              <div *ngIf="client._id !== editable">
                <button matTooltip="Editar cliente" (click)="setEditable(client._id, i); $event.stopPropagation()" 
                class="btn waves-effect waves-light btn-sm btn-success" type="button" style="margin-right: 2px" >
                  <i class="mdi mdi-account-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger"  matTooltip="Eliminar cliente"
                    (click)="deleteClient(client._id, i); $event.stopPropagation()">
                  <i class="mdi mdi-delete"></i>
                </button>
              </div>
              <div *ngIf="client._id === editable">
                <button matTooltip="Editar cliente" (click)="updateUser(client); $event.stopPropagation()" 
                class="btn waves-effect waves-light btn-sm b-green" type="button" style="margin-right: 2px" >
                  <i class="mdi mdi-check"></i>
                </button>
                <button class="btn btn-sm b-red"  matTooltip="Cancelar"
                    (click)="setEditable(null, i); $event.stopPropagation()">
                  <i class="mdi mdi-close"></i>
                </button>
              </div>
             
            </td>
          </ng-container>
          
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </div>
  </div>
</div>